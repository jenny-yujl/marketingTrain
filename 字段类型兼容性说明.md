# å­—æ®µç±»å‹å…¼å®¹æ€§è¯´æ˜

## ğŸ”„ å­—æ®µç±»å‹æ›¿æ¢æ–¹æ¡ˆ

ä¸ºäº†ç¡®ä¿ä¸æ›´å¤šMySQLç‰ˆæœ¬å…¼å®¹ï¼Œæˆ‘ä»¬å¯¹æ•°æ®åº“ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼š

### æ›¿æ¢çš„å­—æ®µç±»å‹

#### 1. JSON â†’ TEXT
**åŸç±»å‹**: `JSON`
**æ–°ç±»å‹**: `TEXT`
**è¯´æ˜**: ä½¿ç”¨TEXTå­—æ®µå­˜å‚¨JSONæ ¼å¼çš„å­—ç¬¦ä¸²

```sql
-- æ›¿æ¢å‰ (MySQL 5.7.8+)
`placements` JSON NOT NULL DEFAULT (JSON_ARRAY())

-- æ›¿æ¢å (MySQL 5.0+)
`placements` TEXT NOT NULL DEFAULT '[]'
```

**å½±å“çš„å­—æ®µ**:
- `placements` - æŠ•æ”¾ä½ç½®æ•°ç»„
- `device_types` - è®¾å¤‡ç±»å‹æ•°ç»„
- `interests` - å…´è¶£æ ‡ç­¾æ•°ç»„
- `behaviors` - è¡Œä¸ºæ ‡ç­¾æ•°ç»„
- `weekly_schedule` - å‘¨æ—¶é—´å®‰æ’æ•°ç»„

#### 2. BOOLEAN â†’ TINYINT(1)
**åŸç±»å‹**: `BOOLEAN`
**æ–°ç±»å‹**: `TINYINT(1)`
**è¯´æ˜**: ä½¿ç”¨TINYINT(1)å­˜å‚¨å¸ƒå°”å€¼ (0=å‡, 1=çœŸ)

```sql
-- æ›¿æ¢å‰ (MySQL 5.0.3+)
`has_time_limited_discount` BOOLEAN DEFAULT FALSE

-- æ›¿æ¢å (MySQL 5.0+)
`has_time_limited_discount` TINYINT(1) DEFAULT 0
```

**å½±å“çš„å­—æ®µ**:
- `has_time_limited_discount` - æ˜¯å¦æœ‰é™æ—¶æŠ˜æ‰£
- `has_full_reduction` - æ˜¯å¦æœ‰æ»¡å‡

## ğŸ“Š å…¼å®¹æ€§å¯¹æ¯”

### MySQLç‰ˆæœ¬è¦æ±‚

| å­—æ®µç±»å‹ | åŸè¦æ±‚ç‰ˆæœ¬ | æ–°è¦æ±‚ç‰ˆæœ¬ | å…¼å®¹æ€§æå‡ |
|---------|------------|------------|------------|
| JSON | 5.7.8+ | - | å·²ç§»é™¤ |
| BOOLEAN | 5.0.3+ | - | å·²ç§»é™¤ |
| TEXT | æ‰€æœ‰ç‰ˆæœ¬ | 5.0+ | âœ… å®Œå…¨å…¼å®¹ |
| TINYINT(1) | æ‰€æœ‰ç‰ˆæœ¬ | 5.0+ | âœ… å®Œå…¨å…¼å®¹ |
| DECIMAL | æ‰€æœ‰ç‰ˆæœ¬ | 5.0+ | âœ… å®Œå…¨å…¼å®¹ |
| TIMESTAMP | æ‰€æœ‰ç‰ˆæœ¬ | 5.0+ | âœ… å®Œå…¨å…¼å®¹ |

### æ”¯æŒçš„MySQLç‰ˆæœ¬
- âœ… MySQL 5.0+ (æ‰€æœ‰ç°ä»£ç‰ˆæœ¬)
- âœ… MySQL 5.1+ 
- âœ… MySQL 5.5+
- âœ… MySQL 5.6+
- âœ… MySQL 5.7+
- âœ… MySQL 8.0+
- âœ… MariaDB 5.5+
- âœ… MariaDB 10.x

## ğŸ’» åº”ç”¨å±‚å¤„ç†

### JSONæ•°æ®å¤„ç†

#### åœ¨åº”ç”¨ä»£ç ä¸­å¤„ç†JSONå­—ç¬¦ä¸²:

```javascript
// å­˜å‚¨æ•°æ®
const placements = ['ç›´æ’­é—´', 'ä¿¡æ¯æµ'];
const placementsString = JSON.stringify(placements);

// æ’å…¥æ•°æ®åº“
INSERT INTO campaigns (placements) VALUES ('["ç›´æ’­é—´", "ä¿¡æ¯æµ"]');

// è¯»å–æ•°æ®
const result = await db.query('SELECT placements FROM campaigns WHERE id = ?', [1]);
const placements = JSON.parse(result[0].placements);
```

#### Drizzle ORMä¸­çš„å¤„ç†:

```typescript
// åœ¨shared/schema.tsä¸­
export const campaigns = mysqlTable("campaigns", {
  // TEXTå­—æ®µä¼šè‡ªåŠ¨å¤„ç†JSONå­—ç¬¦ä¸²
  placements: text("placements").notNull().default('[]'),
  // åº”ç”¨å±‚éœ€è¦æ‰‹åŠ¨è§£æ: JSON.parse(row.placements)
});
```

### BOOLEANæ•°æ®å¤„ç†

#### TINYINT(1)ä½œä¸ºå¸ƒå°”å€¼:

```javascript
// å­˜å‚¨æ•°æ®
const hasDiscount = true;
const hasDiscountInt = hasDiscount ? 1 : 0;

// æ’å…¥æ•°æ®åº“
INSERT INTO campaigns (has_time_limited_discount) VALUES (1);

// è¯»å–æ•°æ®
const result = await db.query('SELECT has_time_limited_discount FROM campaigns WHERE id = ?', [1]);
const hasDiscount = result[0].has_time_limited_discount === 1;
```

## ğŸ”§ æ•°æ®è¿ç§»

### ä»JSONåˆ°TEXT
å¦‚æœæ‚¨å·²æœ‰ä½¿ç”¨JSONå­—æ®µçš„æ•°æ®ï¼š

```sql
-- è¿ç§»JSONæ•°æ®åˆ°TEXT
UPDATE campaigns SET placements = JSON_UNQUOTE(placements) WHERE placements IS NOT NULL;
```

### ä»BOOLEANåˆ°TINYINT
å¦‚æœæ‚¨å·²æœ‰ä½¿ç”¨BOOLEANå­—æ®µçš„æ•°æ®ï¼š

```sql
-- è¿ç§»BOOLEANæ•°æ®åˆ°TINYINT
UPDATE campaigns SET has_time_limited_discount = CAST(has_time_limited_discount AS UNSIGNED);
```

## âš¡ æ€§èƒ½è€ƒè™‘

### TEXTå­—æ®µçš„JSONæ•°æ®æŸ¥è¯¢
```sql
-- ä½¿ç”¨LIKEæŸ¥è¯¢JSONå­—ç¬¦ä¸²ä¸­çš„å€¼
SELECT * FROM campaigns WHERE placements LIKE '%"ç›´æ’­é—´"%';

-- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ (MySQL 5.7+)
SELECT * FROM campaigns WHERE placements REGEXP '"ç›´æ’­é—´"';
```

### TINYINTå¸ƒå°”å€¼æŸ¥è¯¢
```sql
-- ç›´æ¥ä½¿ç”¨æ•°å€¼æ¯”è¾ƒ
SELECT * FROM campaigns WHERE has_time_limited_discount = 1;
SELECT * FROM campaigns WHERE has_time_limited_discount = 0;
```

## ğŸ“‹ å®Œæ•´æ›¿æ¢æ€»ç»“

ç°åœ¨æ•°æ®åº“ä½¿ç”¨çš„å­—æ®µç±»å‹ï¼š
- âœ… **TEXT**: ç”¨äºå­˜å‚¨JSONæ ¼å¼å­—ç¬¦ä¸²
- âœ… **TINYINT(1)**: ç”¨äºå­˜å‚¨å¸ƒå°”å€¼
- âœ… **INT**: ç”¨äºæ•´æ•°
- âœ… **DECIMAL(10,2)**: ç”¨äºé‡‘é¢
- âœ… **TIMESTAMP**: ç”¨äºæ—¶é—´
- âœ… **VARCHAR/TEXT**: ç”¨äºæ–‡æœ¬

è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†ä¸ä»MySQL 5.0å¼€å§‹çš„å‡ ä¹æ‰€æœ‰ç‰ˆæœ¬å…¼å®¹ï¼Œä¸ºæ‚¨çš„åº”ç”¨æä¾›äº†æœ€å¤§çš„éƒ¨ç½²çµæ´»æ€§ã€‚